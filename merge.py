import re
import pandas as pd
import sys
import subprocess
p=subprocess.Popen(["ls"], stdout=subprocess.PIPE)
#output, err = p.communicate()

#file_name=os.system("ls")
#img_name=sys.argv[1]
#file_name="apihooks"+img_name
#xfile_name=re.sub(r'text', r'xlsx', img_name)
#f=os.popen('file_name')
#files=f.read()
#print (files)
#with open(file_name) as s:
#	print (s)	
#	i=0
a=[]
merge_cols = ["pslist", "psscan", "thrdproc", "pspcid", "csrss", "session", "deskthrd", "APIHOOK", "EVENTHOOK", "MALFIND", "MSGHOOK"]
while True:

	line=p.stdout.readline()
	if line !='':
	
		
		if 'xlsx' in line:
			a.append(line)
	
#		print (line)
#		for w in line:
#for word in line:
		
 #print (w)
	else:
		break

#print a	
#	if 'xlsx' in w:
#		a.append(w)	
		#	print(a[i])
		#	print (i)
		#	i=i+1				# Extract apihooked process ID's
#c= list((set(a)))	
#b=[f for f in c if f.isdigit()]
#b=str(b)
#print (a)
#file_name="psxview"+img_name
#print (file_name)
xl_workbook1 = pd.read_excel(a[0].strip())  # Load the excel workbook
xl_workbook2 = pd.read_excel(a[1].strip())
print xl_workbook1.all()
merge_workbook = pd.concat([xl_workbook1, xl_workbook2])
#df = merge_workbook.parse('psxview')  # Parse the sheet into a dataframe
#pl=list(df['PID'])
#print (merge_workbook)

#for j in pl:
#		
#	row=df.loc[df['PID']==int(j)].index[0]
#	col=df.columns.get_loc("APIHOOK")                               # Mark the respective rows with 0
#    	df.iat[row,col]=0

#for i in b:
	#	print(i)
#	row=df.loc[df['PID']==int(i)].index[0]
#	col=df.columns.get_loc("APIHOOK")				# Mark the respective row of those infected process in xlsx file with 1
#	df.iat[row,col]=1 
 


#print(rl)
#print(pl)
merge_workbook1=merge_workbook[merge_cols]
#merge_wbn= merge_workbook1.to_numeric(merge_cols,errors='coerce')
#writer = pd.ExcelWriter(merge_workbook1)
#print (writer)
#merge_workbook1.to_excel(writer,sheet_name='psxview1')
#writer.save()
merge_workbook1.to_excel("merge.xlsx")
