
import re
import pandas as pd
import sys
img_name=sys.argv[1]
file_name="malfind"+img_name
xfile_name=re.sub(r'text', r'xlsx', img_name)
with open(file_name) as s:
	
	i=0
	a=[]
	for line in s:
		if " Pid:" in line:
                        a.append(line.split()[3])


#print (a)
#		for word in line.split():
#			if 'Pid' in :	
#				print (word)
		#	if word.isequal('PID'):
		#		word=word[:-1]
		#		a.append(word)
#	del a[0]
#	print (a)
	#	if "Process" in line:
	#		a.append(line.split()[1])	
		#	print(a[i])
		#	print (i)
		#	i=i+1				# Extract apihooked process ID's
c= list((set(a)))	
#b=list(map(int,b))
b=[f for f in c if f.isdigit()]
print (b)
#file_name="malfind.xlsx"
xl_workbook = pd.ExcelFile("psxview"+xfile_name)  # Load the excel workbook
df = xl_workbook.parse('psxview')  # Parse the sheet into a dataframe
#df['MALFIND'] = pd.to_numeric(df['MALFIND'], errors='coerce')
#df['MALFIND'] = pd.to_numeric(df['MALFIND'], errors='coerce')
#df['MALFIND'] = df['MALFIND'].astype(int)
pl=list(df['PID'])

print (pl)
for j in pl:
	row=df.loc[df['PID']==int(j)].index[0]
#	print ("row is", row)
#	row=df.loc[df['PID']==j]
#	print(row)
	col=df.columns.get_loc("MALFIND")                               # Mark the respective rows with 0
    	df.iat[row,col]=0

for i in b:
	#	print(i)
	row=df.loc[df['PID']==int(i)].index[0]
	col=df.columns.get_loc("MALFIND")				# Mark the respective row of those infected process in xlsx file with 1
	df.iat[row,col]=1 
df['MALFIND'] = df['MALFIND'].astype(int)


#print(rl)
#print(pl)
writer = pd.ExcelWriter("psxview"+xfile_name)
df.to_excel(writer,'psxview')
writer.save()
