import re
import pandas as pd
import sys
img_name=sys.argv[1]
file_name="apihooks"+img_name
with open(file_name) as s:
	
	i=0
	a=[]
	for line in s:
		if "Process" in line:
			a.append(line.split()[1])	
		#	print(a[i])
		#	print (i)
		#	i=i+1				# Extract apihooked process ID's
b= list((set(a)))	
print (b)
file_name="psxview1.xlsx"
xl_workbook = pd.ExcelFile(file_name)  # Load the excel workbook
df = xl_workbook.parse('psxview')  # Parse the sheet into a dataframe
pl=list(df['PID'])


for j in pl:
		
	row=df.loc[df['PID']==int(j)].index[0]
	col=df.columns.get_loc("APIHOOK")                               # Mark the respective rows with 0
    	df.iat[row,col]=0

for i in b:
	#	print(i)
	row=df.loc[df['PID']==int(i)].index[0]
	col=df.columns.get_loc("APIHOOK")				# Mark the respective row of those infected process in xlsx file with 1
	df.iat[row,col]=1 
 


#print(rl)
print(pl)
writer = pd.ExcelWriter('psxview'+img_name)
df.to_excel(writer,'psxview')
writer.save()
