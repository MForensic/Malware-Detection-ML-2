
import re
import pandas as pd
import sys
img_name=sys.argv[1]
file_name="messagehooks"+img_name
xfile_name=re.sub(r'text', r'xlsx', img_name)
with open(file_name) as s:
	
	i=0
	a=[]
	for line in s:
		for word in line.split():
			if word.endswith(')'):
				word=word[:-1]
				a.append(word)
	del a[0]
	print (a)
	#	if "Process" in line:
	#		a.append(line.split()[1])	
		#	print(a[i])
		#	print (i)
		#	i=i+1				# Extract apihooked process ID's
#b= list((set(a)))	
#print (b)
#file_name="msghooks.xlsx"
xl_workbook = pd.ExcelFile("psxview"+xfile_name)  # Load the excel workbook
df = xl_workbook.parse('psxview')  # Parse the sheet into a dataframe
pl=list(df['PID'])


for j in pl:
		
	row=df.loc[df['PID']==int(j)].index[0]
	col=df.columns.get_loc("MSGHOOK")                               # Mark the respective rows with 0
    	df.iat[row,col]=0

for i in a:
	#	print(i)
	if df['PID'].any()==int(i):
		row=df.loc[df['PID']==int(i)].index[0]
		col=df.columns.get_loc("MSGHOOK")				# Mark the respective row of those infected process in xlsx file with 1
		df.iat[row,col]=1
	else:
		print ("No matching process") 
 


#print(rl)
#print(pl)
writer = pd.ExcelWriter("psxview"+xfile_name)
df.to_excel(writer,'psxview')
writer.save()
